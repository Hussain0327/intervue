# Render Blueprint — Intervue backend infrastructure
# https://docs.render.com/blueprint-spec
#
# Usage: Render Dashboard -> Blueprints -> New Blueprint Instance -> select this repo
# Render auto-detects services, databases, and key-value stores from this file.
#
# NOTE: Free tier limitations:
#   - Web services spin down after 15 min idle (~50s cold start)
#   - WebSocket connections drop on spin-down
#   - PostgreSQL expires after 90 days (1GB limit)
#   - Redis has 25MB limit
#   Upgrade to "standard" plan when ready for production use.

services:
  # ── API (web service) ──────────────────────────────────────────────
  - type: web
    name: intervue-api
    runtime: python
    region: oregon
    plan: free
    rootDir: ./services/api
    buildCommand: pip install .
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: intervue-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          name: intervue-redis
          type: keyvalue
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: OPENAI_API_KEY
        sync: false
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: DEEPGRAM_API_KEY
        sync: false
      - key: ELEVENLABS_API_KEY
        sync: false
      - key: CORS_ORIGINS
        value: "https://intervue.vercel.app"
      - key: DEBUG
        value: "false"
      - key: STREAMING_ENABLED
        value: "true"
      - key: STT_PROVIDER
        value: deepgram
      - key: TTS_PROVIDER
        value: elevenlabs
      - key: LLM_PROVIDER
        value: anthropic

  # ── Redis (key-value store) ────────────────────────────────────────
  - type: keyvalue
    name: intervue-redis
    region: oregon
    plan: free
    ipAllowList: []          # Internal access only

# ── PostgreSQL ─────────────────────────────────────────────────────
databases:
  - name: intervue-db
    region: oregon
    plan: free
    databaseName: intervue
    ipAllowList: []            # Internal access only
